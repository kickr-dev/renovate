# Code generated by kickr; DO NOT EDIT.

---
include:

  # semantic-release template
  # https://gitlab.com/to-be-continuous/semantic-release
  - project: to-be-continuous/semantic-release
    ref: e32f092873147606d5cb198bba45b470e4826649 # 4.0.1
    file: "templates/gitlab-ci-semrel.yml"

  # pre-commit template
  # https://gitlab.com/to-be-continuous/pre-commit
  - project: to-be-continuous/pre-commit
    ref: d56e5eb8bc1cf6f038a863678442c50104a3244e # 1.4.0
    file: "templates/gitlab-ci-pre-commit.yml"

  # Renovate template
  # https://gitlab.com/to-be-continuous/renovate
  - project: to-be-continuous/renovate
    ref: 375f05c3ecaca43927de26862f5a95f4655a5284 # 1.8.0
    file: "templates/gitlab-ci-renovate.yml"

variables:
  PRE_COMMIT_FILE: .pre-commit-config.yaml

  RENOVATE_CONFIG_FILE: .gitlab/renovate.json
  RENOVATE_ENDPOINT: "" # force empty endpoint to let Renovate choose with RENOVATE_PLATFORM (or server configuration platform)
  RENOVATE_PLATFORM: github

  SEMREL_AUTO_RELEASE_ENABLED: false
  SEMREL_BRANCHES_REF: /^(master|main|v[0-9]+\.x|v[0-9]+\.[0-9]+\.x|next|alpha|beta|staging|dev|develop|development)$/
  SEMREL_HOOKS_DIR: scripts
  SEMREL_INFO_ON: all
  SEMREL_RELEASE_DISABLED: "true"
  SEMREL_REQUIRED_PLUGINS_FILE: .gitlab/semrel-plugins.txt
  SEMREL_TAG_FORMAT: v$${version}

semantic-release-info:
  variables:
    GIT_DEPTH: "0"
  script:
    - DESCRIBE=$(git describe --tags || echo "v1.0.0")
    - echo "SEMREL_INFO_NEXT_VERSION=v${DESCRIBE#v}" >> "$SEMREL_CONFIG_DIR/semrel.out.env"
    - echo "SEMREL_INFO_NEXT_VERSION_TYPE=build" >> "$SEMREL_CONFIG_DIR/semrel.out.env"
    - cat "$SEMREL_CONFIG_DIR/semrel.out.env"

.renovate-rules: &renovate-rules
  rules:
    # see https://gitlab.com/to-be-continuous/renovate/-/blob/master/templates/gitlab-ci-renovate.yml?ref_type=heads#L348
    # update mode only with schedule triggering
    - if: $CI_PIPELINE_SOURCE == 'schedule'
      variables:
        RENOVATE_DRY_RUN: "false"
    # dry run with web triggering
    - if: $CI_PIPELINE_SOURCE == 'web'

renovate-validator:
  rules:
    - when: never # validates projects configurations and not server configurations

renovate-depcheck:
  <<: *renovate-rules
