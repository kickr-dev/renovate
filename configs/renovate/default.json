// https://docs.renovatebot.com/configuration-options/

{
    "$schema": "https://docs.renovatebot.com/renovate-schema.json",

    "enabled": true,
    "extends": [
        ":disableRateLimiting",
        ":enableVulnerabilityAlertsWithLabel(vulnerability)",
        ":gitSignOff",
        ":ignoreModulesAndTests",
        ":labels(dependencies, renovate)",
        "group:recommended",
        "helpers:pinGitHubActionDigests",
        "mergeConfidence:age-confidence-badges",
        "replacements:all",
        "security:openssf-scorecard",
        "workarounds:all"
    ],
    "branchPrefix": "renovate/",

    "branchConcurrentLimit": 0,
    "prCreation": "immediate",

    "dependencyDashboard": false,
    "osvVulnerabilityAlerts": false, // https://github.com/renovatebot/renovate/discussions/20542
    "forkProcessing": "disabled",

    "minimumReleaseAge": "5 days",
    "fetchChangeLogs": "pr",

    "semanticCommits": "auto",
    "semanticCommitType": "chore",
    "semanticCommitScope": "deps",

    "baseBranches": [
        "$default",
        "/^v[0-9]+\\.x$/",
        "/^v[0-9]+\\.[0-9]+\\.x$/"
    ],

    "assigneesFromCodeOwners": true,
    "bbUseDefaultReviewers": true,
    "gitLabIgnoreApprovals": true,
    "reviewersFromCodeOwners": true,

    "assignAutomerge": true,
    "automerge": false,
    "automergeStrategy": "fast-forward",
    "automergeType": "pr",
    "platformAutomerge": true,

    "rebaseLabel": "rebase",
    "stopUpdatingLabel": "pause",

    "separateMinorPatch": false,
    "separateMultipleMinor": false,
    "separateMultipleMajor": true,

    "configMigration": false, // removes comments and sets indent to 2 and add a lot of newlines (https://github.com/renovatebot/renovate/issues/16359)

    "postUpdateOptions": [
        "helmUpdateSubChartArchives"
    ],
    "rangeStrategy": "bump",
    "updateLockFiles": true,
    "useBaseBranchConfig": "none",

    "digest": {
        "enabled": false
    },

    "packageRules": [
        {
            "matchCategories": [
                "cd",
                "ci",
                "helm",
                "kubernetes",
                "terraform"
            ],
            "semanticCommitType": "ci"
        },
        {
            "matchCategories": ["ci"],
            "groupName": "CI dependencies",
            "groupSlug": "ci-dependencies"
        },
        {
            "matchCategories": ["cd"],
            "groupName": "CD dependencies",
            "groupSlug": "cd-dependencies"
        },
        {
            "matchCategories": ["helm"],
            "groupName": "Helm dependencies",
            "groupSlug": "helm-dependencies"
        },
        {
            "matchCategories": ["kubernetes"],
            "groupName": "Kubernetes dependencies",
            "groupSlug": "kubernetes-dependencies"
        },
        {
            "matchCategories": ["terraform"],
            "groupName": "Terraform dependencies",
            "groupSlug": "terraform-dependencies"
        },
        {
            "addLabels": ["major"],
            "matchUpdateTypes": ["major"]
        }
    ],

    "customManagers": [
        {
            "customType": "regex",
            "description": "Update any version in ya?ml files",
            "managerFilePatterns": [
                "/.*\\.ya?ml.*$/"
            ],
            "matchStrings": [
                // renovate: datasource=<datasource> packageName=<packageName> (depName=<depName>, i.e. optional) (versioning=<versioning>, i.e. optional)
                // <text>: <currentValue>
                "renovate:\\sdatasource=(?<datasource>\\S+)\\spackageName=(?<packageName>\\S+)(?:\\sdepName=(?<depName>\\S+))?(?:\\sversioning=(?<versioning>\\S+))?\\s*\\S+:\\s{0,1}(?<currentValue>[\\w.+-]+)\\n"
            ]
        }
    ]
}
